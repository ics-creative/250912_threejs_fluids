import{u as P,T as C,a as R,V as g,v as D,s as q,N as E,e as L,g as A,r as ae,d as $,w as ne,W as re,S as ie,O as oe,M as se,P as ue,R as I,F as Y,h as _,i as K,C as F,y as G,j as le,k as ce,m as de,n as me,o as we,x as fe,L as ge,z as he,p as pe,q as ve}from"./PointerManager-ZLIzfdCe.js";const xe=()=>{const e=P(new C),t=R(new g),s=R(new g(1,1)),i=D(q.xy).mul(t),n=D(i.x,i.y.oneMinus()),a=e.sample(n),r=new E;return r.vertexNode=L(),r.fragmentNode=a,A(r,{uImage:e,uTextureSize:t,uImageScale:s})},Se=()=>{const e=P(new C),t=P(new C),s=R(new g),i=R(new g),n=R(0),a=D(q.xy).mul(i),r=e.sample(a).toVar(),h=a.sub(r.xy.mul(n).mul(s).mul(3)),N=ae(h,i),V=t.sample(N).rgb,B=$(V,1),p=new E;return p.vertexNode=L(),p.fragmentNode=B,A(p,{uData:e,uImage:t,uTexelSize:s,uTextureSize:i,uDeltaT:n})},Te=()=>{const e=P(new C),t=R(new g),s=R(new g),n=D(q.xy).mul(t).sub(.5).mul(s).add(.5),a=n.x.greaterThanEqual(0).and(n.x.lessThanEqual(1)),r=n.y.greaterThanEqual(0).and(n.y.lessThanEqual(1)),h=a.and(r),N=e.sample(n),V=$(0,0,0,1),B=ne(h,N,V),p=new E;return p.vertexNode=L(),p.fragmentNode=B,A(p,{uImage:e,uTextureSize:t,uImageScale:s})},d={pixelRatio:.5,solverIteration:5,forceRadius:20,forceCoefficient:1e3,dissipation:.996};let Q=0;const v=new pe;let o,b,O,M,y=Math.round(window.innerWidth*window.devicePixelRatio*d.pixelRatio),x=Math.round(window.innerHeight*window.devicePixelRatio*d.pixelRatio),c=new g,u,l,S,T,m,U,j,k,J,X,W,f;await Re();te(performance.now());async function Re(){o=new re({antialias:!1,forceWebGL:!1}),await o.init(),o.setPixelRatio(window.devicePixelRatio),o.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(o.domElement),b=new ie,O=new oe(-1,1,1,-1,0,1),M=new se(new ue(2,2)),b.add(M);const e={wrapS:F,wrapT:F,minFilter:K,magFilter:K,format:_,type:Y,depthBuffer:!1,stencilBuffer:!1};u=new I(y,x,e),l=new I(y,x,e),Z(u),Z(l);const t={wrapS:F,wrapT:F,minFilter:G,magFilter:G,format:_,type:Y,depthBuffer:!1,stencilBuffer:!1};T=new I(window.innerWidth,window.innerHeight,t),m=new I(window.innerWidth,window.innerHeight,t),U=le(),j=ce(),k=de(),J=me(),X=we(),W=Se(),f=xe(),await ze(f),S=new fe().load("texture_demo3.jpg",()=>{H()}),S.minFilter=ge,S.magFilter=G,S.colorSpace=he,window.addEventListener("resize",H),v.init(),H()}function H(){o.setPixelRatio(window.devicePixelRatio),o.setSize(window.innerWidth,window.innerHeight);const e=window.innerWidth*window.devicePixelRatio,t=window.innerHeight*window.devicePixelRatio;y=Math.round(e*d.pixelRatio),x=Math.round(t*d.pixelRatio),u.setSize(y,x),l.setSize(y,x),T.setSize(e,t),m.setSize(e,t),v.resizeTarget(d.pixelRatio,o.backend.coordinateSystem===ve?x:0),c.set(1/y,1/x),U.uniforms.uTexelSize.value.copy(c),j.uniforms.uTexelSize.value.copy(c),k.uniforms.uTexelSize.value.copy(c),J.uniforms.uTexelSize.value.copy(c),X.uniforms.uTexelSize.value.copy(c),W.uniforms.uTexelSize.value.copy(c),W.uniforms.uTextureSize.value.set(1/e,1/t),f.uniforms.uTextureSize.value.set(1/e,1/t),ye(),f.uniforms.uImage.value.source?.data&&f.uniforms.uImageScale.value.copy(ee(e,t,f.uniforms.uImage.value.width,f.uniforms.uImage.value.height))}function ye(){const e=Te(),t=e.uniforms;t.uImage.value=S,t.uTextureSize.value.set(1/m.width,1/m.height),t.uImageScale.value.copy(ee(m.width,m.height,S.width,S.height)),w(e,T)}function ee(e,t,s,i){const n=e/t,a=s/i,r=n>=a?n/a:1,h=n>=a?1:a/n;return new g(r,h)}function te(e){const t=(e-Q)/1e3;if(v.isPointerDown){const i=U,n=i.uniforms,a=v.pointer.clone().sub(v.prevPointer).multiply(c).multiplyScalar(d.forceCoefficient);n.uData.value=u.texture,n.uForceCenter.value.copy(v.pointer.clone().multiply(c)),n.uForceDeltaV.value.copy(a),n.uForceRadius.value=d.forceRadius,w(i,l),z()}const s=Math.min(Math.max(Math.floor(t*240),1),8);for(let i=0;i<s;i++){const n=t/s;{const a=j,r=a.uniforms;r.uData.value=u.texture,r.uDeltaT.value=n,r.uDissipation.value=d.dissipation,w(a,l),z()}{const a=k,r=a.uniforms;r.uData.value=u.texture,w(a,l),z()}for(let a=0;a<d.solverIteration;a++){const r=J,h=r.uniforms;h.uData.value=u.texture,w(r,l),z()}{const a=X,r=a.uniforms;r.uData.value=u.texture,w(a,l),z()}{const a=W,r=a.uniforms;r.uImage.value=T.texture,r.uData.value=u.texture,r.uDeltaT.value=n,w(a,m),[T,m]=[m,T]}}{const i=f,n=i.uniforms;n.uImage.value=T.texture,w(i,null)}v.updatePreviousPointer(),Q=e,requestAnimationFrame(te)}function Z(e){o.setRenderTarget(e),o.clearColor(),o.setRenderTarget(null)}function w(e,t){M.material=e,o.setRenderTarget(t),o.render(b,O),o.setRenderTarget(null)}function z(){[u,l]=[l,u]}async function ze(e){M.material=e;const t=await o.debug.getShaderAsync(b,O,M);console.log(t.vertexShader),console.log(t.fragmentShader)}
