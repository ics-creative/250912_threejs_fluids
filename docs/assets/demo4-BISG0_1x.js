import{u as W,T as B,a as i,V as w,v as u,s as K,A as me,t as Ce,d as _,N as Q,e as X,g as Y,B as Fe,D as N,l as Me,E as Pe,r as Ge,G as We,H as fe,I as Be,c as Ie,J as Ne,W as Ae,S as He,O as Ve,M as Le,P as ke,R as A,F as se,h as ue,i as le,C as H,y as U,j as je,k as qe,m as Ee,n as Oe,o as Ue,x as Je,L as Ke,z as _e,p as Qe,q as Xe}from"./PointerManager-ZLIzfdCe.js";import{h as Ye}from"./hsv2rgb-DZmtbqKI.js";const Ze=()=>{const t=W(new B),a=W(new B),s=i(new w),o=i(new w),e=i(new w),n=i(new w),r=i(0),v=i(0),S=i(0),z=i(0),b=u(K.xy).mul(o),c=u(b.x,b.y.oneMinus()),k=Te=>{const Re=u(Te).mul(n),De=Fe(n.x.div(e.x),n.y.div(e.y)),ie=u(e).mul(De),ze=u(n).sub(ie).mul(.5),M=u(Re).sub(ze).div(ie),be=N(0,M.x).mul(N(0,M.y)).mul(N(M.x,1)).mul(N(M.y,1));return a.sample(M).rgb.mul(be)},j=t.sample(c).r,q=t.sample(c.sub(u(s.x,0))).r,E=t.sample(c.add(u(s.x,0))).r,F=t.sample(c.sub(u(0,s.y))).r,we=t.sample(c.add(u(0,s.y))).r,ve=u(E.sub(q).mul(.5),we.sub(F).mul(.5)),xe=c.add(ve.mul(r)),ge=k(xe),re=me(v.mul(j).mul(-1)),Se=Ye(z,.5,1).mul(S.mul(Ce(1).sub(re))),he=ge.mul(re).add(Se),ye=_(he,1),O=new Q;return O.vertexNode=X(),O.fragmentNode=ye,Y(O,{uDye:t,uBackground:a,uDyeTexel:s,uScreenTexel:o,uBGSizePx:e,uScreenSizePx:n,uRefractAmp:r,uDensityK:v,uSmokeGain:S,uTimeStep:z})},$e=()=>{const t=W(new B),a=W(new B),s=i(new w),o=i(new w),e=i(0),n=i(0),r=i(0),v=u(K.xy).mul(o),S=t.sample(v).toVar(),z=e.mul(Me(S.xy)),b=Pe(.02,.1,z),c=v.sub(S.xy.mul(n).mul(e).mul(s).mul(b)),k=Ge(c,o),j=a.sample(k).rgb,q=We(.5,e.div(fe(r,1e-6))),E=_(j.mul(q),1),F=new Q;return F.vertexNode=X(),F.fragmentNode=E,Y(F,{uData:t,uImage:a,uTexelSize:s,uTextureSize:o,uDeltaT:e,uDyeAdvectScale:n,uHalfLife:r})},et=()=>{const t=W(new B),a=i(new w),s=i(new w),o=i(0),e=i(new Be),n=i(0),r=u(K.xy).mul(a),v=t.sample(r).rgb.toVar(),S=r.sub(s).div(fe(u(o).mul(a),u(1e-6))),z=Ie(v.add(e.mul(n).mul(me(Ne(S,S).mul(-1)))),0,1),b=_(z,1),c=new Q;return c.vertexNode=X(),c.fragmentNode=b,Y(c,{uImage:t,uTextureSize:a,uForceCenter:s,uForceRadius:o,uDyeColor:e,uInjectGain:n})},f={pixelRatio:.5,solverIteration:5,forceRadius:20,forceCoefficient:1e3,dissipation:.996};let ce=0;const x=new Qe;let l,V,Z,I,C=Math.round(window.innerWidth*window.devicePixelRatio*f.pixelRatio),D=Math.round(window.innerHeight*window.devicePixelRatio*f.pixelRatio),m=new w,P=new w,d,p,R,g,y,$,ee,te,ae,ne,oe,L,T;await tt();pe(performance.now());async function tt(){l=new Ae({antialias:!1,forceWebGL:!1}),await l.init(),l.setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(l.domElement),V=new He,Z=new Ve(-1,1,1,-1,0,1),I=new Le(new ke(2,2)),V.add(I);const t={wrapS:H,wrapT:H,minFilter:le,magFilter:le,format:ue,type:se,depthBuffer:!1,stencilBuffer:!1};d=new A(C,D,t),p=new A(C,D,t),de(d),de(p);const a={wrapS:H,wrapT:H,minFilter:U,magFilter:U,format:ue,type:se,depthBuffer:!1,stencilBuffer:!1};g=new A(window.innerWidth,window.innerHeight,a),y=new A(window.innerWidth,window.innerHeight,a),$=je(),ee=qe(),te=Ee(),ae=Oe(),ne=Ue(),oe=et(),L=$e(),T=Ze(),await at(T),R=new Je().load("texture_demo4.jpg",()=>{T.uniforms.uBGSizePx.value.set(R.width,R.height),J()}),R.minFilter=Ke,R.magFilter=U,R.colorSpace=_e,T.uniforms.uBackground.value=R,window.addEventListener("resize",J),x.init(),J()}function J(){l.setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight);const t=window.innerWidth*window.devicePixelRatio,a=window.innerHeight*window.devicePixelRatio;C=Math.round(t*f.pixelRatio),D=Math.round(a*f.pixelRatio),d.setSize(C,D),p.setSize(C,D),g.setSize(t,a),y.setSize(t,a),x.resizeTarget(f.pixelRatio,l.backend.coordinateSystem===Xe?D:0),m.set(1/C,1/D),P.set(1/t,1/a),$.uniforms.uTexelSize.value.copy(m),ee.uniforms.uTexelSize.value.copy(m),te.uniforms.uTexelSize.value.copy(m),ae.uniforms.uTexelSize.value.copy(m),ne.uniforms.uTexelSize.value.copy(m),oe.uniforms.uTextureSize.value.copy(P),L.uniforms.uTexelSize.value.copy(m),L.uniforms.uTextureSize.value.copy(P),T.uniforms.uDyeTexel.value.copy(P),T.uniforms.uScreenTexel.value.copy(P),T.uniforms.uScreenSizePx.value.set(t,a)}function pe(t){const a=(t-ce)/1e3;if(x.isPointerDown){const o=$,e=o.uniforms,n=x.pointer.clone().sub(x.prevPointer).multiply(m).multiplyScalar(f.forceCoefficient);e.uData.value=d.texture,e.uForceCenter.value.copy(x.pointer.clone().multiply(m)),e.uForceDeltaV.value.copy(n),e.uForceRadius.value=f.forceRadius,h(o,p),G()}const s=Math.min(Math.max(Math.floor(a*240),1),8);for(let o=0;o<s;o++){const e=a/s;{const n=ee,r=n.uniforms;r.uData.value=d.texture,r.uDeltaT.value=e,r.uDissipation.value=f.dissipation,h(n,p),G()}{const n=te,r=n.uniforms;r.uData.value=d.texture,h(n,p),G()}for(let n=0;n<f.solverIteration;n++){const r=ae,v=r.uniforms;v.uData.value=d.texture,h(r,p),G()}{const n=ne,r=n.uniforms;r.uData.value=d.texture,h(n,p),G()}}if(x.isPointerDown){const o=oe,e=o.uniforms;e.uImage.value=g.texture,e.uForceCenter.value.copy(x.pointer.clone().multiply(m)),e.uForceRadius.value=f.forceRadius,e.uDyeColor.value.set(.2,.2,.2),e.uInjectGain.value=10,h(o,y),[g,y]=[y,g]}{const o=L,e=o.uniforms;e.uImage.value=g.texture,e.uData.value=d.texture,e.uDeltaT.value=a,e.uDyeAdvectScale.value=10,e.uHalfLife.value=.3,h(o,y),[g,y]=[y,g]}{const o=T,e=o.uniforms;e.uDye.value=g.texture,e.uRefractAmp.value=.9,e.uDensityK.value=.9,e.uSmokeGain.value=.8,e.uTimeStep.value=t*1e-4,h(o,null)}x.updatePreviousPointer(),ce=t,requestAnimationFrame(pe)}function de(t){l.setRenderTarget(t),l.clearColor(),l.setRenderTarget(null)}function h(t,a){I.material=t,l.setRenderTarget(a),l.render(V,Z),l.setRenderTarget(null)}function G(){[d,p]=[p,d]}async function at(t){I.material=t;const a=await l.debug.getShaderAsync(V,Z,I);console.log(a.vertexShader),console.log(a.fragmentShader)}
