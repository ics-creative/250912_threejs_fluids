import{u as G,T as q,d as z,V as T,e as P,s as _,y as $,h as B,v as ee,z as ae,N as te,i as ne,j as re,W as ie,S as oe,O as se,M as ue,P as le,R as E,k as ce,m as de,n as L,C as N,o as me,p as fe,q as we,r as pe,t as ge,A as he,L as ve,B as xe,D as Se,w as Te,x as Re}from"./PointerManager-DkWebD9_.js";const ye=()=>{const a=G(new q),t=G(new q),d=z(new T),w=z(new T),r=z(new T(1,1)),e=P(_.xy).mul(w),n=P(e.x,e.y.oneMinus()),p=a.sample(n).toVar(),v=n.sub(.5).mul(r).add(.5),O=v.x.greaterThanEqual(0).and(v.x.lessThanEqual(1)),j=v.y.greaterThanEqual(0).and(v.y.lessThanEqual(1)),k=O.and(j),J=P(1.2).mul(p.xy).mul(d),X=$(v.sub(J),d),Y=t.sample(X).rgb,K=B(Y.add(ee(p.z.mul(.01))),1),Q=B(0,0,0,1),Z=ae(k,K,Q),M=new te;return M.vertexNode=ne(),M.fragmentNode=Z,re(M,{uTexture:a,uImage:t,uTexelSize:d,uTextureSize:w,uImageScale:r})},c={pixelRatio:.5,solverIteration:5,forceRadius:20,forceCoefficient:1e3,dissipation:.996};let A=0;const m=new Te;let i,y,F,R,h=Math.round(window.innerWidth*window.devicePixelRatio*c.pixelRatio),f=Math.round(window.innerHeight*window.devicePixelRatio*c.pixelRatio),l=new T,o,u,S,b,D,I,W,V,s;await Me();U(performance.now());async function Me(){i=new ie({antialias:!1,forceWebGL:!1}),await i.init(),i.setPixelRatio(window.devicePixelRatio),i.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(i.domElement),y=new oe,F=new se(-1,1,1,-1,0,1),R=new ue(new le(2,2)),y.add(R);const a={wrapS:N,wrapT:N,minFilter:L,magFilter:L,format:de,type:ce,depthBuffer:!1,stencilBuffer:!1};o=new E(h,f,a),u=new E(h,f,a),H(o),H(u),b=me(),D=fe(),I=we(),W=pe(),V=ge(),s=ye(),await Pe(s),S=new he().load("texture.jpg",()=>{C()}),S.minFilter=ve,S.magFilter=xe,S.colorSpace=Se,window.addEventListener("resize",C),m.init(),C()}function C(){i.setPixelRatio(window.devicePixelRatio),i.setSize(window.innerWidth,window.innerHeight);const a=window.innerWidth*window.devicePixelRatio,t=window.innerHeight*window.devicePixelRatio;h=Math.round(a*c.pixelRatio),f=Math.round(t*c.pixelRatio),o.setSize(h,f),u.setSize(h,f),m.resizeTarget(c.pixelRatio,i.backend.coordinateSystem===Re?f:0),l.set(1/h,1/f),b.uniforms.uTexelSize.value.copy(l),D.uniforms.uTexelSize.value.copy(l),I.uniforms.uTexelSize.value.copy(l),W.uniforms.uTexelSize.value.copy(l),V.uniforms.uTexelSize.value.copy(l),s.uniforms.uTexelSize.value.copy(l),s.uniforms.uTextureSize.value.set(1/a,1/t),s.uniforms.uImage.value.source?.data&&s.uniforms.uImageScale.value.copy(ze(a,t,s.uniforms.uImage.value.width,s.uniforms.uImage.value.height))}function ze(a,t,d,w){const r=a/t,e=d/w,n=r>=e?r/e:1,p=r>=e?1:e/r;return new T(n,p)}function U(a){const t=(a-A)/1e3;if(m.isPointerDown){const r=b,e=r.uniforms,n=m.pointer.clone().sub(m.prevPointer).multiply(l).multiplyScalar(c.forceCoefficient);e.uData.value=o.texture,e.uForceCenter.value.copy(m.pointer.clone().multiply(l)),e.uForceDeltaV.value.copy(n),e.uForceRadius.value=c.forceRadius,g(r,u),x()}const d=Math.max(Math.floor(t*240),1),w=t/d;for(let r=0;r<d;r++){{const e=D,n=e.uniforms;n.uData.value=o.texture,n.uDeltaT.value=w,n.uDissipation.value=c.dissipation,g(e,u),x()}{const e=I,n=e.uniforms;n.uData.value=o.texture,g(e,u),x()}for(let e=0;e<c.solverIteration;e++){const n=W,p=n.uniforms;p.uData.value=o.texture,g(n,u),x()}{const e=V,n=e.uniforms;n.uData.value=o.texture,g(e,u),x()}}{const r=s,e=r.uniforms;e.uTexture.value=o.texture,s.uniforms.uImage.value=S,g(r,null)}m.updatePreviousPointer(),A=a,requestAnimationFrame(U)}function H(a){i.setRenderTarget(a),i.clearColor(),i.setRenderTarget(null)}function g(a,t){R.material=a,i.setRenderTarget(t),i.render(y,F),i.setRenderTarget(null)}function x(){[o,u]=[u,o]}async function Pe(a){R.material=a;const t=await i.debug.getShaderAsync(y,F,R);console.log(t.vertexShader),console.log(t.fragmentShader)}
