import{u as U,T as k,a as C,V as A,v as F,s as L,f as j,b as J,l as K,c as Q,d as X,N as Y,e as Z,g as _,W as $,S as ee,O as te,M as ae,P as ne,R as W,F as ie,h as re,i as D,C as V,j as oe,k as se,m as le,n as ue,o as de,p as ce,q as me}from"./PointerManager-ZLIzfdCe.js";import{h as fe}from"./hsv2rgb-DZmtbqKI.js";const we=()=>{const t=U(new k),n=C(new A),w=C(1),v=F(L.xy).mul(n),o=F(v.x,v.y.oneMinus()),e=t.sample(o).toVar(),q=j(J(e.y,e.x).mul(1/(Math.PI*2))).mul(2).sub(1).abs().mul(-1).add(1).mul(1/6).add(w),E=K(e.xy),I=Q(E.mul(40),.3,.9),O=X(fe(q,I,.9),1),S=new Y;return S.vertexNode=Z(),S.fragmentNode=O,_(S,{uTexture:t,uTextureSize:n,uTimeStep:w})},l={pixelRatio:.5,solverIteration:5,forceRadius:20,forceCoefficient:500,dissipation:.96};let G=0;const d=new ce;let a,x,T,h,f=Math.round(window.innerWidth*window.devicePixelRatio*l.pixelRatio),c=Math.round(window.innerHeight*window.devicePixelRatio*l.pixelRatio),u=new A,r,s,R,y,M,P,b,g;await pe();B(performance.now());async function pe(){a=new $({antialias:!1,forceWebGL:!1}),await a.init(),a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(a.domElement),x=new ee,T=new te(-1,1,1,-1,0,1),h=new ae(new ne(2,2)),x.add(h);const t={wrapS:V,wrapT:V,minFilter:D,magFilter:D,format:re,type:ie,depthBuffer:!1,stencilBuffer:!1};r=new W(f,c,t),s=new W(f,c,t),H(r),H(s),R=oe(),y=se(),M=le(),P=ue(),b=de(),g=we(),await he(g),window.addEventListener("resize",N),d.init(),N()}function N(){a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight);const t=window.innerWidth*window.devicePixelRatio,n=window.innerHeight*window.devicePixelRatio;f=Math.round(t*l.pixelRatio),c=Math.round(n*l.pixelRatio),r.setSize(f,c),s.setSize(f,c),d.resizeTarget(l.pixelRatio,a.backend.coordinateSystem===me?c:0),u.set(1/f,1/c),R.uniforms.uTexelSize.value.copy(u),y.uniforms.uTexelSize.value.copy(u),M.uniforms.uTexelSize.value.copy(u),P.uniforms.uTexelSize.value.copy(u),b.uniforms.uTexelSize.value.copy(u),g.uniforms.uTextureSize.value.set(1/t,1/n)}function B(t){const n=(t-G)/1e3;if(d.isPointerDown){const o=R,e=o.uniforms,i=d.pointer.clone().sub(d.prevPointer).multiply(u).multiplyScalar(l.forceCoefficient);e.uData.value=r.texture,e.uForceCenter.value.copy(d.pointer.clone().multiply(u)),e.uForceDeltaV.value.copy(i),e.uForceRadius.value=l.forceRadius,m(o,s),p()}const w=Math.min(Math.max(Math.floor(n*240),1),8),v=n/w;for(let o=0;o<w;o++){{const e=y,i=e.uniforms;i.uData.value=r.texture,i.uDeltaT.value=v,i.uDissipation.value=l.dissipation,m(e,s),p()}{const e=M,i=e.uniforms;i.uData.value=r.texture,m(e,s),p()}for(let e=0;e<l.solverIteration;e++){const i=P,z=i.uniforms;z.uData.value=r.texture,m(i,s),p()}{const e=b,i=e.uniforms;i.uData.value=r.texture,m(e,s),p()}}{const o=g,e=o.uniforms;e.uTexture.value=r.texture,e.uTimeStep.value=t*1e-4,m(o,null)}d.updatePreviousPointer(),G=t,requestAnimationFrame(B)}function H(t){a.setRenderTarget(t),a.clearColor(),a.setRenderTarget(null)}function m(t,n){h.material=t,a.setRenderTarget(n),a.render(x,T),a.setRenderTarget(null)}function p(){[r,s]=[s,r]}async function he(t){h.material=t;const n=await a.debug.getShaderAsync(x,T,h);console.log(n.vertexShader),console.log(n.fragmentShader)}
