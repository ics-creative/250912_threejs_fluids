import{u as W,T as B,a as i,V as v,v as l,s as J,e as de,b as be,c as _,N as Q,d as X,f as Y,m as Ce,g as I,l as Fe,h as Me,i as Pe,p as Ge,j as me,k as We,n as Be,o as He,P as Ie,W as Ne,S as Ae,O as Le,M as Ve,q as ke,R as N,F as je,r as se,t as ue,C as A,H as Ee,L as U,w as qe,x as Oe,y as Ue,z as Ke,A as Je,B as _e,D as Qe,E as Xe,G as Ye}from"./PointerManager-ChHyotI4.js";/* empty css              */import{h as Ze}from"./hsv2rgb-DZoVPHCW.js";const $e=()=>{const t=W(new B),a=W(new B),u=i(new v),o=i(new v),e=i(new v),n=i(new v),r=i(0),x=i(0),y=i(0),z=i(0),b=l(J.xy).mul(o),c=l(b.x,b.y.oneMinus()),k=he=>{const Te=l(he).mul(n),Re=Ce(n.x.div(e.x),n.y.div(e.y)),ie=l(e).mul(Re),De=l(n).sub(ie).mul(.5),M=l(Te).sub(De).div(ie),ze=I(0,M.x).mul(I(0,M.y)).mul(I(M.x,1)).mul(I(M.y,1));return a.sample(M).rgb.mul(ze)},j=t.sample(c).r,E=t.sample(c.sub(l(u.x,0))).r,q=t.sample(c.add(l(u.x,0))).r,F=t.sample(c.sub(l(0,u.y))).r,pe=t.sample(c.add(l(0,u.y))).r,we=l(q.sub(E).mul(.5),pe.sub(F).mul(.5)),ve=c.add(we.mul(r)),xe=k(ve),re=de(x.mul(j).mul(-1)),ge=Ze(z,.5,1).mul(y.mul(be(1).sub(re))),ye=xe.mul(re).add(ge),Se=_(ye,1),O=new Q;return O.vertexNode=X(),O.fragmentNode=Se,Y(O,{uDye:t,uBackground:a,uDyeTexel:u,uScreenTexel:o,uBGSizePx:e,uScreenSizePx:n,uRefractAmp:r,uDensityK:x,uSmokeGain:y,uTimeStep:z})},et=()=>{const t=W(new B),a=W(new B),u=i(new v),o=i(new v),e=i(0),n=i(0),r=i(0),x=l(J.xy).mul(o),y=t.sample(x).toVar(),z=e.mul(Fe(y.xy)),b=Me(.02,.1,z),c=x.sub(y.xy.mul(n).mul(e).mul(u).mul(b)),k=Pe(c,o),j=a.sample(k).rgb,E=Ge(.5,e.div(me(r,1e-6))),q=_(j.mul(E),1),F=new Q;return F.vertexNode=X(),F.fragmentNode=q,Y(F,{uData:t,uImage:a,uTexelSize:u,uTextureSize:o,uDeltaT:e,uDyeAdvectScale:n,uHalfLife:r})},tt=()=>{const t=W(new B),a=i(new v),u=i(new v),o=i(0),e=i(new We),n=i(0),r=l(J.xy).mul(a),x=t.sample(r).rgb.toVar(),y=r.sub(u).div(me(l(o).mul(a),l(1e-6))),z=Be(x.add(e.mul(n).mul(de(He(y,y).mul(-1)))),0,1),b=_(z,1),c=new Q;return c.vertexNode=X(),c.fragmentNode=b,Y(c,{uImage:t,uTextureSize:a,uForceCenter:u,uForceRadius:o,uDyeColor:e,uInjectGain:n})},p={pixelRatio:.5,solverIteration:5,forceRadius:20,forceCoefficient:1e3,dissipation:.996};let le=0;const m=new Ie;let s,L,Z,H,C=Math.round(window.innerWidth*window.devicePixelRatio*p.pixelRatio),D=Math.round(window.innerHeight*window.devicePixelRatio*p.pixelRatio),f=new v,P=new v,d,w,R,g,h,$,ee,te,ae,ne,oe,V,T;await at();fe(performance.now());async function at(){s=new Ne({antialias:!1,forceWebGL:!1}),await s.init(),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(s.domElement),L=new Ae,Z=new Le(-1,1,1,-1,0,1),H=new Ve(new ke(2,2)),L.add(H);const t={wrapS:A,wrapT:A,minFilter:ue,magFilter:ue,format:se,type:je,depthBuffer:!1,stencilBuffer:!1};d=new N(C,D,t),w=new N(C,D,t),ce(d),ce(w);const a={wrapS:A,wrapT:A,minFilter:U,magFilter:U,format:se,type:Ee,depthBuffer:!1,stencilBuffer:!1};g=new N(window.innerWidth,window.innerHeight,a),h=new N(window.innerWidth,window.innerHeight,a),$=qe(),ee=Oe(),te=Ue(),ae=Ke(),ne=Je(),oe=tt(),V=et(),T=$e(),await nt(T),R=new _e().load("texture_demo1.jpg",()=>{T.uniforms.uBGSizePx.value.set(R.width,R.height),K()}),R.minFilter=Qe,R.magFilter=U,R.colorSpace=Xe,T.uniforms.uBackground.value=R,window.addEventListener("resize",K),m.init(s.domElement),m.addEventListener("firstInteraction",()=>{document.querySelector("#overlay-hint").style.display="none"}),K()}function K(){s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight);const t=window.innerWidth*window.devicePixelRatio,a=window.innerHeight*window.devicePixelRatio;C=Math.round(t*p.pixelRatio),D=Math.round(a*p.pixelRatio),d.setSize(C,D),w.setSize(C,D),g.setSize(t,a),h.setSize(t,a),m.resizeTarget(p.pixelRatio,s.backend.coordinateSystem===Ye?D:0),f.set(1/C,1/D),P.set(1/t,1/a),$.uniforms.uTexelSize.value.copy(f),ee.uniforms.uTexelSize.value.copy(f),te.uniforms.uTexelSize.value.copy(f),ae.uniforms.uTexelSize.value.copy(f),ne.uniforms.uTexelSize.value.copy(f),oe.uniforms.uTextureSize.value.copy(P),V.uniforms.uTexelSize.value.copy(f),V.uniforms.uTextureSize.value.copy(P),T.uniforms.uDyeTexel.value.copy(P),T.uniforms.uScreenTexel.value.copy(P),T.uniforms.uScreenSizePx.value.set(t,a)}function fe(t){const a=(t-le)/1e3;if(m.isPointerDown){const o=$,e=o.uniforms,n=m.pointer.clone().sub(m.prevPointer).multiply(f).multiplyScalar(p.forceCoefficient);e.uData.value=d.texture,e.uForceCenter.value.copy(m.pointer.clone().multiply(f)),e.uForceDeltaV.value.copy(n),e.uForceRadius.value=p.forceRadius,S(o,w),G()}const u=Math.min(Math.max(Math.floor(a*240),1),8);for(let o=0;o<u;o++){const e=a/u;{const n=ee,r=n.uniforms;r.uData.value=d.texture,r.uDeltaT.value=e,r.uDissipation.value=p.dissipation,S(n,w),G()}{const n=te,r=n.uniforms;r.uData.value=d.texture,S(n,w),G()}for(let n=0;n<p.solverIteration;n++){const r=ae,x=r.uniforms;x.uData.value=d.texture,S(r,w),G()}{const n=ne,r=n.uniforms;r.uData.value=d.texture,S(n,w),G()}}if(m.isPointerDown){const o=oe,e=o.uniforms;e.uImage.value=g.texture,e.uForceCenter.value.copy(m.pointer.clone().multiply(f)),e.uForceRadius.value=p.forceRadius,e.uDyeColor.value.set(.2,.2,.2),e.uInjectGain.value=10,S(o,h),[g,h]=[h,g]}{const o=V,e=o.uniforms;e.uImage.value=g.texture,e.uData.value=d.texture,e.uDeltaT.value=a,e.uDyeAdvectScale.value=10,e.uHalfLife.value=.3,S(o,h),[g,h]=[h,g]}{const o=T,e=o.uniforms;e.uDye.value=g.texture,e.uRefractAmp.value=.9,e.uDensityK.value=.9,e.uSmokeGain.value=.8,e.uTimeStep.value=t*1e-4,S(o,null)}m.updatePreviousPointer(),le=t,requestAnimationFrame(fe)}function ce(t){s.setRenderTarget(t),s.clearColor(),s.setRenderTarget(null)}function S(t,a){H.material=t,s.setRenderTarget(a),s.render(L,Z),s.setRenderTarget(null)}function G(){[d,w]=[w,d]}async function nt(t){H.material=t;const a=await s.debug.getShaderAsync(L,Z,H);console.log(a.vertexShader),console.log(a.fragmentShader)}
